% !TeX spellcheck = en_GB
% !TeX program = xelatex
% !TeX root = md2-user-handbook.tex

\subsection{Setting up your \MD Model Development Environment}

The following software is required to enable modelling of \MD models and deployment of generated backends:

\begin{itemize}
\item A current Eclipse IDE with support for Java EE development (e.g. Luna)
\item Using the \href{https://eclipse.org/Xtext/download.html}{Xtext Update Site}, install a current version of the Xtext redistributable
\item From the archive that you obtained, install the \MD features
\item GlassFish 4.+
\end{itemize}

You are ready to go.


\subsection{Setting up a \mapapps Development Environment}
\label{subsec:basic-setup}

As a prerequisite, ensure that the following software is installed:

\begin{itemize}
\item \mapapps 3.1.0
\item NetBeans EE (e.g. Version 8.0)
\item Apache Tomcat 7.0 with running \mapapps runtime\footnote{For details on their installation, please refer to the \mapapps documentation.}
\end{itemize}

\begin{enumerate}
\item {Set up your \mapapps  development environment in NetBeans}

\begin{enumerate}
\item Extract the \lstinline|sampleProjRemote| project from the \mapapps distribution and load it in NetBeans. \label{item:extraction}
\item In its \lstinline|pom.xml|,
 set the \lstinline|mapapps.remote.base| directive to the URL where the \mapapps runtime is installed.
\item Right-click the project, select \enquote{Custom} and select \enquote{Goals...} to create a new Maven goal. \todo{Describe configuration}
\item Open the \lstinline|nbactions.xml|. \todo{Describe set property for Jetty port 9090}

\end{enumerate}

\item Deploy the generic \MD runtime bundles by copying the \MD runtime bundles into the directory \lstinline[language=Simple]|src/main/js/bundles/| in the project:
	\begin{quotation}
		 \lstinline|md2_formcontrols|
		 
		 \lstinline|md2_list_of_open_issues|
		 
		 \lstinline|md2_local_store|
		 
		 \lstinline|md2_location_service|
		 
		 \lstinline|md2_runtime|
		 		 
		 \lstinline|md2_store|
		 
		 \lstinline|md2_workflow_store|
		 
		 \lstinline|onlinestatus|
	\end{quotation}

\item As soon as you have a generated \mapapps app: Copy it into the \lstinline[language=Simple]|src/main/js/app/| directory of the project or use a symbolic link to reference apps from another location (see \Cref{subsec:link-apps}).


\end{enumerate}

\subsection{Setting up GlassFish to Run Generated Backends}

\begin{enumerate}

\item Configure Eclipse to manage GlassFish
%Hint for developers of MD2:
%As you typically work in at least two instances of Eclipse, you are now free to choose which one you want to use for managing the backend.
%However, we suggest to use the generated instance, since this way all your app-related contents will be within this generated instance.
%All MD2 framework-related contents reside in the other instance.

\begin{enumerate}
\item In Eclipse, open the Servers tab.
\item Right-click it and choose \enquote{New} $\rightarrow$ \enquote{Server}.
\item If the GlassFish adapter is not installed yet (look for \enquote{GlassFish} in the list of types), click \enquote{Download additional server adapters} and install the entry \enquote{GlassFish Tools}.
\item From the list of types, choose \enquote{GlassFish} $\rightarrow$ \enquote{GlassFish 4.0} and click \enquote{Next}.
% (in the next line, GlassFish is written with lowercase F on purpose! Field is actually named this way.)
\item For the Glassfish Server Directory field, navigate to the \lstinline[language=Simple]|glassfish/| subdirectory in your installation. If you entered the correct path, it should output something similar to
	\begin{quotation}
	\enquote{Found GlassFish Server version 4.0.0}.
	\end{quotation}
	Otherwise, follow the assistant's hints.
\item Click \enquote{Finish}.

\end{enumerate}



\item Start GlassFish and add the Backend

	The following steps will start the server.
	Therefore, please grant all privileges that your firewall asks for, if any, so that the server can be accessed.

\begin{enumerate}
\item Within the GlassFish installation directory, navigate to \lstinline[language=Simple]|glassfish/bin/|.
\item Run the \lstinline[language=Simple]|asadmin| utility (Windows: Double-click on \lstinline[language=Simple]|asadmin.bat|, Linux/OS X: Open a terminal in that directory and run \lstinline[language=Simple]|./asadmin|).
\item In the GlassFish administration utility, type \lstinline[language=Simple]|start-database| to start the Derby database for the backend.
\item Start Eclipse and import the generated project \lstinline[language=Simple]|<PROJECT_NAME>.backend| by choosing \enquote{General} $\rightarrow$ \enquote{Existing Projects into Workspace} in the import wizard.
\item In the Project Explorer tab, right-click the project in Eclipse, choose \enquote{Properties}, and navigate to \enquote{Targeted Runtime}.
\item Deselect all runtimes and click \enquote{Apply}.
\item Select the item \enquote{GlassFish 4.0} and click \enquote{Apply}.
\item Correct JRE-related build path problems, if any, by resorting to the default JRE.
\item Confirm by clicking \enquote{OK}.
\item In the Servers tab, right-click the \enquote{GlassFish 4.0} entry, and choose \enquote{Add/Remove}.
\item Add the backend project to the server.
\item Start the server.
\end{enumerate}


\end{enumerate}